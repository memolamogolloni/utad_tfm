\chapter{Estado del arte}
En este cap\'itulo, por una parte se hace un breve repaso de los diferentes sistemas de almacenamiento m\'as comunes en aplicaciones web
y las diferencias entre ellos, que sirven para contextualizar la implementaci\'on del modelo de datos sobre una base de datos no
relacional basada en documentos que se describe en el Cap\'itulo 5.
Adem\'as, se comentan brevemente los avances en t\'ecnicas de visualizaci\'on realistas en motores de renderizado en tiempo real, que suponen
el marco te\'orico de este proyecto. Muchas de estas t\'ecnicas se analizan en detalle en el cap\'itulo 4.

% \section{Arquitectura y almacenamiento en aplicaciones web}
% El patr\'on m\'as utilizado en la actualidad para la organizaci\'on de un proyecto web es el MVC, o modelo vista controlador.
% El modelo representa a la base de datos, mientras que el controlador es la aplicaci\'on en el lado del servidor que act\'ua
% como intermediaria entre las peticiones del usuario y las consultas a la base de datos y finalmente la vista es la visualizaci\'on
% que se le ofrece al usuario para permitirle interactuar con la aplicaci\'on.

\section{Sistemas de almacenamiento}
En la actualidad, los modelos de bases de datos m\'as utilizados son SQL \autocite{sql}, un sistema de filas y columnas
contenidas en tablas y relacionadas a trav\'es de claves y NoSQL, que agrupa a un conjunto de sistemas de datos no relacionales.
Mientras que las bases de datos relacionales aseguran la consistencia de los datos cumpliendo con las propiedades ACID
\autocite{acid}, los sistemas NoSQL nacieron durante los a\~nos 90 para dar respuesta a la alta disponibilidad de los recursos debido al creciente
n\'umero de usuarios de las aplicaciones web. Otras car\'acter\'isticas de los sistemas NoSQL son su flexibilidad en el modelo de datos
y su escalabilidad horizontal, al soportar estructuras distribu\'idas. Dentro de los sistemas no relacionales, podemos identificar
cuatro grupos principales: las bases de datos de clave/valor, en la sus datos se organizan en una estructura parecida a un diccionario
y ofrece una respuesta con muy baja latencia, bases de datos basadas en documentos, que relacionan una clave con una estructura
de datos compleja, bases de datos basadas en columnas, muy comunes en aplicaciones Big Data al funcionar muy bien sobre sistemas
distribu\'idos muy grandes y bases de datos basadas en grafos, que utilizan colecciones de nodos unidos por aristas que definen
las relaciones entre nodos.

        % \textbf{Graph databases}\\
        % Modeled after the concept of a mathematical graph, the graph database contains a collection of items (called nodes) and edges 
        % known as graphs) which define the relationships between items. Graph databases are designed for transactional integrity,
        % flexibility, and operational availability, making them a good choice for a range of use cases requiring speedy parsing of
        % relationships between heterogeneous data points – applications such as fraud prevention, advanced enterprise operations, online
        % transaction processing (OLTP), certain types of data security, churn analysis, and regulatory reporting, to name a few.

        % Their data models are a lot simpler than those of relational or other NoSQL databases. A drawback to widespread adoption, though,
        % is the lack of a standard graph database query language. You can’t use SQL (that’s what “NoSQL” means) or any other popular language.
        % Aspiring graph database developers should plan on acquiring fluency in a language only applicable to a few databases.\textbf{Neo4j}

        % \textbf{Key-value databases}\\
        % Another specialized non-relational type is the key-value database. Similar to a dictionary, it is used for fairly simply-organized
        % information that needs to be accessed with very low latency. A typical use case is the storage of configuration data. While these
        % lightweight databases are not that widely known, one was voted the “most loved database” in a popular annual survey for three years
        % running. \textbf{Redis}

        % \textbf{Document databases}\\
        % Document databases pair each key with a complex data structure known as a document. Documents can contain many different
        % key-value pairs, or key-array pairs, or even nested documents. MongoDB is a document database. \textbf{MongoDB}

        % \textbf{Column store databases}\\
        % The other NoSQL database type is known as a column store, wide column store, or column family database. Very fast and monstrously
        % scalable, these are capable of accommodating petabytes of data in vast distributed systems with thousands of servers. All of this
        % makes them perfect for specific kinds of Big Data applications.\textbf{Cassandra}

    % El modelo de base de datos no relacional fue introducido  por Edgar F. Codd \autocite{sql}, utilizando un sistema de filas y
    % columnas asociadas utilizando las claves de las filas. SQL ha sido usado y es usado extensivamente desde su nacimiento,
    % sin embargo, las nuevas necesidades de las aplicaciones durante los a\~nos 90 el nacimiento de nuevos sistemas de informaci\'on
    % las bases de datos no relacionales, que permiten una alta disponibilidad de los datos, a coste de no cumplir las propiedades ACID
    % frente a la consistencia de las bases de datos relacionales, las NoSQL aportan flexibilidad en sus estructuras de datos,
    % escalabidad horizontal, al soportar estructuras distribuidas y una alta disponibilidad de los datos

\section{T\'ecnicas de visualizaci\'on realista en tiempo real}

El primer modelo de BRDF basado en aspectos f\'isicos fue presentado por Robert Coook y Ephraim Sparrow en 1967 \autocite{torrancesparrow}
y presenta por primera vez el modelo de microfacetas en el que se basan todos los modelos de BRDF realistas presentados posteriormente.
Ya en 1981, el modelo de Cook-Torrance \autocite{cooktorrance} combina las ideas del modelo de microfacetas y la funci\'on de distribuci\'on
de las normales de Beckmann \autocite{beckmann} y presenta nuevas ideas como que solo las microfacetas orientadas en direcci\'on al
vector medio entre la luz y el puntos de vista contribuyen a la reflexi\'on especular, la conservaci\'on de la energ\'ia entre las
componentes difusa y especular o la separaci\'on en el modelo de materiales seg\'un su conductividad: met\'alicos o diel\'ectricos.

% Los primeros algoritmos de sombreado en gr\'aficos renderizados presentados durante la d\'ecada de los 70 por Gouraud
% \autocite{gouraud}, Phong \autocite{phong} y James Blinn \autocite{blinnphong} son modelos emp\'iricos que describen el comportamiento de la luz sobre una superficie
% como un ratio entre la luz recibida por la superficie y la reflejada. En 1981 se presenta el el modelo de Cook-Torrance \autocite{cooktorrance},
% un modelo basado en el modelo f\'isico de la luz y las caracter\'isticas f\'isicas de la superficie para conseguir una
% representaci\'on realista de una amplia variedad de materiales.

% que se presenta el primer modelo basado en aspectos f\'isicos, el modelo de Cook-Torrance \autocite{cooktorrance}.
% Este modelo tiene en cuenta el modelo f\'isico de la luz y las caracter\'isticas f\'isicas de la superficie para conseguir una
% representaci\'on realista de una amplia variedad de materiales. La teor\'ia de microfacetas, los t\'erminos del BRDF o la
% separaci\'on de la reflexi\'on en sus componentes difusa y especular est\'an presentes en la amplia mayor\'ia de modelos modernos
% de BRDF.


% En 1970 se presenta el primer algoritmo de sombreado en gr\'aficos rasterizados \autocite{gouraud}, posteriormente 
% Phong \autocite{phong} presentada un modelo para la componente especular, revisado y mejorado posteriormente por James Blinn
% \autocite{blinnphong}. Estos modelos consiguen describir el comportamiento del material en todos sus puntos,
% estableciendo un ratio entre la luz que llega a una superficie y la luz reflejada, sin embargo no tienen en cuenta el modelo f\'isico de
% la luz, por lo que no podemos hablar de materiales PBR hasta 1981, a\~no en el que Robert Cook y Kenneth Torrance presentan su modelo
% de BRDF basado en microfacetas \autocite{cooktorrance}

    \subsection{Componentes y t\'erminos del BRDF basado en microfacetas}
    El modelo de Cook-Torrance \autocite{cooktorrance}, explicado en detalle en el Cap\'itulo 3, permite representar una amplia
    variedad de materiales y, aunque con variaciones en sus t\'erminos, es el modelo de referencia de BRDF basado en aspectos f\'isicos.
    A continuaci\'on se detallan los trabajos sobre el c\'alculo de sus componentes y t\'erminos.
    % las diferentes aproximaciones para el c\'alculo de las
    % componentes difusa y especular y sus t\'erminos.
    % \todo[inline]{
    %     Blinn \autocite{blinn77}, Beckmann \autocite{beckmann}, Walter \autocite{ggx}, Neumann \autocite{neumann}, Kelemen
    %     \autocite{kelemen}, Smith \autocite{smith}, Karis \autocite{unreal}, \autocite{reed}
    % }

    % El modelo de Cook-Torrance \autocite{cooktorrance}, que explicaremos en detalle en el Cap\'itulo 4, sus principales aportaciones son
    % separar el BRDF como la suma de sus dos componentes, especular y difuso y utilizar un BRDF especular basado en microfacetas. El BRDF
    % especular es la como la combinaci\'on de los t\'erminos de distribuci\'on de las normales, el de geometr\'ia o visibilidad que modela
    % los fen\'omenos de sombra y enmascaramiento y el de Fresnel.

        \subsubsection{Componente difusa}
            Las superficies lambertianas son superfies ideales que reflejan la luz incidente en todas direcciones por igual, por lo
            que su radiancia es independiente del punto de vista. Este modelo de superficie ideal de reflexi\'on difusa fue presentado
            por Johann Heinrich Lambert 1760 \autocite{lambert} y es el utilizado en los modelos de Torrance-Sparrow \autocite{torrancesparrow}
            y Cook-Torrance \autocite{cooktorrance}.\\

            El modelo lambertiano supone una aproximaci\'on lo suficientemente precisa para representar una amplia variedad de
            materiales y es utilizado todav\'ia en la actualidad por gran cantidad de motores de renderizado realista, entre ellos,
            ThreeJs. Sin embargo, el t\'ermino no tiene en cuenta la conservaci\'on de la energ\'ia y
            cuando se utiliza en conjunto con un BRDF basado de microfacetas, genera oscurecimiento en las zonas de mayor rugosidad,
            que se acent\'ua a medida que aumenta el \'angulo de incidencia de la luz.\\
            
            El modelo de Oren-Nayar \autocite{orennayar}, basado en la teor\'ia de microfacetas, presenta por primera vez un t\'ermino
            difuso f\'isicamente plausible y es el modelo en el que se inspira el factor de correci\'on sobre la componente difusa que
            simula el efecto de absorci\'on y reflexi\'on interna presentado en este trabajo.\\

            % Los modelos de presentados por Disney en 2012  \autocite{disney12} y 2015 \autocite{disney15} o los
            % trabajos de Yoshiharu Gotanda \autocite{gotanda14} o Eal Hammon \autocite{earlhammon} ofrecen sucesivas aproximaciones
            % para una componente difusa basada en f\'isica teniendo en cuenta la distribuci\'on de las microfacetas en funci\'on de
            % los t\'erminos utilizados para la componente especular.

            % el concepto de difusi\'on perfecta, superficies cuya radiancia no
            % dependen del punto de vista, si no que parecen tener la misma radiancia desde todas las direcciones.\\
            % El modelo de Lambert fue utilizado por el modelo Cook-Torrance \autocite{cooktorrance} y a\'un a d\'ia de hoy se sigue
            % utilizando con frecuencia al considerarse una aproximaci\'on razonablemente buena para la reflexi\'on difusa.
            % de una gran parte de materiales. Sin embargo, este modelo ideal no tiene en cuenta la conservaci\'on
            % de la energ\'ia y cuando se utiliza en conjunto con un BRDF basado en f\'isica, podemos observar un oscurecimiento
            % en las zonas de mayor rugosidad, que se acent\'ua a medida que aumenta al incrementar el \'angulo de incidencia de la luz.\\
            % El modelo de Oren-Nayar \autocite{orennayar}, presenta por primera vez un t\'ermino difuso f\'isicamente plausible,
            % basado en la teor\'ia de microfacetas, especialmente en el trabajo de Torrance-Sparrow \autocite{torrancesparrow}.\\
            % M\'as tarde, los modelos de Disney \autocite{disney12} \autocite{disney15}, Yoshiharu Gotanda \autocite{gotanda14} o Eal Hammon
            % \autocite{earlhammon} presentaron sucesivas aproximaciones a la componente difusa basada en f\'isica teniendo en cuenta la
            % distribuci\'on de las microfacetas dependiendo de los t\'erminos utilizados para la componente especular.

        \subsubsection{Componente especular}
            El BRDF especular basado en microfacetas consta de tres t\'erminos, una funci\'on de distribuci\'on de las normales, una funci\'on
            de geometr\'ia, la ecuaci\'on de Fresnel, a continuaci\'on un breve repaso de las diferentes implementaciones de estos
            t\'erminos.
        
        % El BRDF de Cook-Torrance est\'a compuesto por otras tres funciones y un factor de normalizaci\'on en el denominador.
        % Las funciones D, F y G, se corresponden con la funci\'on de distribuci\'on de las normales, la ecuaci\'on de Fresnel,
        % y la funci\'on de geometr\'ia.\\ 

        % Aunque podemos considerar la mayor\'ia de materiales como isotr\'opicos, la radiancia de los puntos de su superficie no dependen
        % del angulo de rotacion sobre la normal de la superficie, existen materiales sobre los que \'esta rotaci\'on s\'i afecta
        % a la radiancia de salida. La mayor\'ia de modelos anal\'iticos presentan un modelo isotr\'opico, que es suficiente para
        % representar una amplia variedad de materiales, sin embargo exiten alguno modelos que se encargan de representar \'estas
        % variaciones en la normal de la superficie seg\'un la rotaci\'on.\\
        % A continuaci\'on se describen los diferentes modelos para cada t\'ermino del BRDF:

            \subsubsection*{T\'ermino D}
                Mientras que el modelo de Torrance-Sparrow \autocite{torrancesparrow} presenta una distribuci\'on gaussiana, el modelo
                de Cook-Torrance \autocite{cooktorrance} utiliza el t\'ermino presentado en 1963 por Beckmann \autocite{beckmann}.\\

                El modelo de Disney 2012 \autocite{disney12} es el utilizado por ThreeJs para modelar la componente especular de sus
                materiales PBR, mientras que el presentado por Heitz \autocite{ggx} es uno de los m\'as extendidos en la actualidad.\\

                Por otra parte, el modelo de Est\'evez y Kulla \autocite{sheenbrdf}, basado en el trabajo de Ashikhmin y Premoze \autocite{ashikhmin00},
                presenta un nuevo par\'ametro que ofrece mayor control sobre la componente especular, muy \'util para ciertos tipos de
                tejido y que se utiliza en el modelo para tejidos presentado en este trabajo.\\

                % Recientemente, podemos destacar como modelos isotr\'opicos como los presentados por Disney \autocite{disney12}, el modelo
                % de Eric Heitz \autocite{ggx} o el modelo de \textit{sheen} \autocite{sheenbrdf}, muy adecuado para la representaci\'on de tejidos
                % y que explicaremos en detalle en el Cap\'itulo 5.\\

                % Por otra parte, el modelo anisotr\'opico de Phong \autocite{anisotropicphong} fue el primer modelo en representar
                % \'este tipo de superficies, posteriormente, el modelo anistro\'opico de Beckmann \autocite{beckmannspinozo} o el de
                % GGX \autocite{anisotropicggx} han trabajado tambi\'en sobre \'este tipo de materiales
            
                % \todo[inline]{
                %     Estevez and Kulla propose a different NDF (called the “Charlie” sheen) that is based on an exponentiated
                %     sinusoidal instead of an inverted Gaussian. This NDF is appealing for several reasons: its parameterization
                %     feels more natural and intuitive, it provides a softer appearance and, as shown in equation 49, its
                %     implementation is simpler:
                % }

            \subsubsection*{T\'ermino F}
                El t\'ermino F es una aproximaci\'on de la funci\'on de Fresnel. La primera aproximaci\'on de de la funci\'on de Fresnel
                fue la presentada por Cook-Torrance. M\'as tarde Schlick \autocite{schlick}, Largarde \autocite{frostbite} y Gotanda \autocite{gotanda}
                presentaron sucesivas aproximaciones.

            \subsubsection*{T\'ermino G}
                El t\'ermino de geometr\'ia fue presentado en el modelo de microfacetas de Cook-Torrance \autocite{cooktorrance}
                y se utiliza para describir la cantidad de microfacetas que quedan en sombra y depende t\'ipicamente de los par\'ametros
                de rugosidad y distribuci\'on de las microfacetas.\\
                
                % Adem\'as del citado modelo, tambi\'en son populares los modelos de
                % Neumann \autocite{neumann}, Kelemen \autocite{kelemen} o el presentado de por Neubelt \autocite{theordertalk} y
                % \\
                
                En la actualidad los modelos m\'as usados son los basados en el m\'etodo de Smith \autocite{smith}, que
                consiste en separar la f\'ormula en dos partes que utilizan la misma ecuaci\'on pero una utilizando el vector de vista
                y otra la de la luz, representando los fen\'omenos de sombreado y enmascaramiento respectivamente. De entre \'estos t\'erminos
                de geometr\'ia, cabe destacar el trabajo de Earl Hammon \autocite{earlhammon}, el modelo de Schlick-Beckmann \autocite{schlick},
                o el utilizado en Unreal \autocite{unreal}, que remapea el valor de rugosidad para conseguir unos valores m\'as intuitivos para
                los artistas. El modelo presentado por Neubelt \autocite{theorder} es el utilizado para el BRDF de telas integrado sobre
                ThreeJs.
                
        \subsection{Luz indirecta en tiempo real}
        La ecuaci\'on para el c\'alculo de iluminaci\'on indirecta, analizada en detalle en el Cap\'itulo 4, fue presentada por primera vez
        por Kajiya \autocite{kajiya}, sin embargo la parte integral de la ecuaci\'on supone un c\'alculo recursivo que no puede ser resulto
        en tiempo real. Es por ello, que para los motores de renderizado en tiempo real, se utilizan t\'ecnicas que permiten conseguir
        \'este efecto, a trav\'es de precalculos o aproximaciones anal\'iticas.

            \subsubsection*{C\'alculo de la componente difusa}
            Para calcular la irradiancia sobre un punto debida al entorno, Paul Debevec \autocite{debevec} present\'o la t\'ecnica
            de mapas de irradiancia, mientras que en 2001, Ravi Ramamoorthi y Pat Hanrahan \autocite{sh} presentan la t\'ecnica de esf\'ericos har\'omicos,
            que permite la compresi\'on de informaci\'on utilizando una representaci\'on de frecuencias de color frente a espacio.

            \subsubsection*{C\'alculo de la componente especular}
            La aproximaci\'on de sumas parciales \autocite{unreal}, que se comenta en detalle en el Cap\'itulo 3 permite el c\'aculo de la reflexi\'on especular separando el c\'alculo
            de la integral en dos partes, la integral de la radiancia sobre un punto y el c\'alculo del BRDF. La t\'ecnica utiliza
            un mapa de entorno prefiltrado y un \textit{look-up table} (LUT) que almacena los resultados precomputados del BRDF.
            Adem\'as existen funciones anal\'iticas como la presentada por Epic Games \autocite{dfgapproximation} y que se utiliza en ThreeJs
            como aproximaci\'on a la soluci\'on a la integral del BRDF.
            
            % que permiten aproximar el c\'alculo del BRDF y son una buena aproximaci\'on para dispositivos con un rendimiento limitado
            % como la utizada por Epic Games \autocite{dfgapproximation}
            % y que utiliza ThreeJs para aproximar la integral del BRDF 
            % para plataformas m\'oviles o la presentada por Krzysztof Narkowicz \autocite{narkowicz}, que resultan una buena aproximaci\'on
            % en dispositivos con un rendimiento limitado.

        \subsection{Modelos de renderizado interactivos de referencia}
        Hoy d\'ia el modelo de referencia es el de Disney \autocite{disney12} \autocite{disney15}, conocido como \textit{"Principled"},
        y que se analiza en detalle en el Cap\'itulo 4. Adem\'as los modelos de Electronic Arts \autocite{frostbite}, Unreal \autocite{unreal}
        o Filament \autocite{filament} son implementaciones completas de modelos de BRDDF que integran iluminaci\'on global y  que sirven
        de inspiraci\'on a otros motores de renderizado en tiempo real.
